<!DOCTYPE html>
<!-- Etiqueta que define la raíz del documento -->
<html>
  <!-- Etiqueta que define el título, metadatos y diversos enlaces -->
  <head>
    <!-- Titulo que aparece en la pestaña de la página web -->
    <title>Visor Cartográfico</title>

    <!-- Metadatos de la página -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Demo project with jQuery">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Enlaces a librerías, hojas de estilo y plugins de leaflet  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
    <link rel="stylesheet" href="css/leaflet-sidebar.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@d4cbd36122efc8d17152b4177ed0e12165305441/dist/css/L.Control.OpenCageData.Search.min.css" />
    <link rel="stylesheet" href="css/catastro.css" />
    <link rel="stylesheet" href="css/leaflet.groupedlayercontrol.min.css" />
    <link rel="stylesheet" href="css/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="css/Control.FullScreen.css" />
    <link rel="stylesheet" href="css/Control.Coordinates.css" />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/leaflet-search.css" />
    <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css" />
    <link rel="stylesheet" href="css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="css/L.Control.Locate.min.css" />

  </head>
  <!-- Cuerpo de la página web, donde se va a mostrar el contenido al usuario  -->
  <body>  
    <!-- Barra de navegación superior de la página web con diferentes opciones para interactuar con otros html  -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Visor Cartográfico</a>
          </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active"><a href="#">Accesibilidad en el municipio de Zaragoza</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <!-- Barra de navegación situada en la parte izquierda del visor para interactuar con las capas, leyenda, etc.  -->
    <div id="container" class="container-fluid">
        <div id="sidebar" class="sidebar collapsed">
          <div class="sidebar-tabs">
              <ul role="tablist">
                  <li><a href="#home" role="tab"><i class="fa fa-map"></i></a></li>
                  <li><a href="#leyenda" role="tab"><i class="fa fa-photo"></i></a></li>
                  <li><a href="#rutas" role="tab"><i class="fa fa-road"></i></a></li>
                  <li><a href="#contacto" role="tab"><i class="fa fa-user"></i></a></li>
                  <li><a href="#info" role="tab"><i class="fa fa-info-circle"></i></a></li>
                </ul>
  
              <ul role="tablist">
                  <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
              </ul>
          </div>
          <div class="sidebar-content">
          <div class="sidebar-pane" id="home">
              <h1 class="sidebar-header">Capas<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <div class="" id="control-capas">
              </div>
          </div>
          <div class="sidebar-pane" id="leyenda">
              <h1 class="sidebar-header">Leyenda<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <div class="" id="control-leyenda">
              <br>
              </div>
          </div>
          <div class="sidebar-pane" id="rutas">
              <h1 class="sidebar-header">Calculadora de rutas<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <div class="" id="control-rutas">
                <br><h4>¿Cómo funciona?</h4>
                <p>En el visor se pueden observar dos popups o marcadores de color azul los cuales se corresponden con las localizaciondes de inicio y final de la ruta. Una vez colocadas donde queramos, abriremos la ventana emergente de Calculadora de rutas (donde nos encontramos ahora mismo) y, en la parte inferior podremos ver el itinerario completo de la ruta más óptima, además de los kilómetros y tiempo aproximado de realización.</p>
                <br><h4>Itinerario</h4>
              </div>
          </div>
          <div class="sidebar-pane" id="info">
            <h1 class="sidebar-header">Información y uso del visor<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            <br>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                  <li><a class="dropdown-item" href="#">Introducción</a></li>
                  <li><a class="dropdown-item" href="#">Cómo funciona</a></li>
                  <li><a class="dropdown-item" href="#">Datos</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            <br>
            <p>El siguiente visor cartográfico ha sido realizado por Héctor Sandoval como <b>proyecto final de máster de Tecnologías de la información: Teledetección y Sistemas de Información geográfica de la Universidad de Zaragoza</b>. <p></p>Tiene como objetivo, facilitar la accesibilidad de la población en la ciudad de Zaragoza con la interacción de una serie de capas y herramientas de transporte o enrutamiento. </p> <p>Para llevar a cabo el visor, en primer lugar se adquirió la información del <b>Catálogo de datos abiertos del ayuntamiento de Zaragoza</b>, posteriormente se incorporaron dichos datos en una base de datos mediante PostgreSQL. Una vez llevado a cabo dicho proceso, se convirtieron los datos en información mediante su visualización en geoserver, servidor a partir del cual se dió estilo a los diferentes servicios WMS y, finalmente se llevó a cabo la programación del visor así como la incorporación de los servicios WMS y WFS en el mismo.</p> 
          </div>
          <div class="sidebar-pane" id="contacto">
              <h1 class="sidebar-header">Contacto<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <br>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav" text-align=center>
                  <h4>Correo electrónico</h4><li><a class="dropdown-item" href="mailto:hectorsandovalcordon@gmail.com" target="_blank"><i class="fa fa-envelope"></i></a></li>
                  <br><br><br><h4>LinkedIn</h4><li><a class="dropdown-item" href="https://www.linkedin.com/in/hectorsandovalcordon/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
                  <br><br><br><h4>Web personal</h4><li><a class="dropdown-item" href="https://hectorsandovalcordon.github.io/tfm/" target="_blank"><i class="fa fa-copy"></i></a></li>
                    </ul>
                  </li>
                </ul>
              </div>
          </div>
          <div class="sidebar-pane" id="settings">
              <h1 class="sidebar-header">Ajustes<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <br><h4>Transparencia</h4>
                <input id="slide" type="range" min="0" max="1" step="0.1" value="0" onchange="updateOpacity(this.value)">  
            </div>
          </div>
        </div>
        <!-- Incorporación del mapa a la página web  -->
        <div id="mapid"></div>
  </body>
    <!-- Diferentes scripts javascript de la página web bootstrap, leaflet, etc.  -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <script src="js/leaflet-sidebar.min.js"></script>
    <script src="js/bundle.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="data/postes_urbanos_0.js"></script>
    <script src="data/paradas_tranvia.js"></script>
    <script src="data/paradas_taxi.js"></script>
    <script src="data/apar_discapacitados.js"></script>
    <script src="data/aparc_publico.js"></script>
    <script src="data/parquimetros.js"></script>
    <script src="js/leaflet.groupedlayercontrol.min.js"></script>
    <script src="js/Control.Coordinates.js"></script>
    <script src="js/Control.FullScreen.js"></script>
    <script src="js/leaflet-routing-machine.js"></script>
    <script src="js/Control.Geocoder.js"></script>
    <script src="js/config.js"></script>
    <script src="js/index.js"></script>
    <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
    <script src="js/leaflet-search.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script type="text/javascript">
        var highlightLayer;
            function highlightFeature(e) {
                highlightLayer = e.target;
                if (e.target.feature.geometry.type === 'LineString') {
                highlightLayer.setStyle({
                    color: '#EFEB11',
                });
                } else {
                highlightLayer.setStyle({
                    fillColor: '#EFEB11',
                    fillOpacity: 0.4
                });
                }
            }

        var map = L.map ('mapid',{
        center:[41.65, -0.85],
        zoom: 13,
        fullscreenControl: true,
                fullscreenControlOptions: { // optional
                    title:"Mostrar pantalla completa",
                    titleCancel:"Salir del modo pantalla completa"
                }
            });

        map.on('enterFullscreen', function(){
                if(window.console) window.console.log('enterFullscreen');
            });
            map.on('exitFullscreen', function(){
                if(window.console) window.console.log('exitFullscreen');
        });
        map.on('click', function(e) {
            c.setCoordinates(e);
            });

    var sidebar = L.control.sidebar('sidebar').addTo(map); 
    var carto = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
      attribution: '&copy; <a>Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL.</a> contributors'
    }).addTo(map);

    var controlRutas = L.Routing.control({
        waypoints: [
            L.latLng(41.6476, -0.9133),
            L.latLng(41.6477, -0.8969)
        ],
        routeWhileDragging: true,
        }).addTo(map);
        document.getElementById("control-rutas").appendChild(controlRutas.getContainer()
        );

    var linbus = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "lineas_autobus",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });

        var paradas_bus = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "paradas_bus",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_postes_urbanos_0(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Parada</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['id'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Tiempo de espera</strong><br />' + (feature.properties['title'] !== null ? Autolinker.link(String(feature.properties['title'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Tiempo de espera</strong><br />' + (feature.properties['link'] !== null ? Autolinker.link(String(feature.properties['link'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        } //Atributos y características de los popups de cada una de las paradas
        function style_postes_urbanos_0_0() {
            return {
                pane: 'pane_postes_urbanos_0',
                radius: 8.0,
                opacity: 0,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 0,
                fillColor: '#2986D4',
            }
        } //Estilo de cada uno de los popups de las paradas
        map.createPane('pane_postes_urbanos_0');
        map.getPane('pane_postes_urbanos_0').style.zIndex = 400;
        map.getPane('pane_postes_urbanos_0').style['mix-blend-mode'] = 'normal';
        var layer_postes_urbanos_0 = new L.geoJson(json_postes_urbanos_0, {
            attribution: '',
            pane: 'pane_postes_urbanos_0',
            onEachFeature: pop_postes_urbanos_0,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_postes_urbanos_0_0(feature));
            },
        }); //Estilos de los postes, en este caso circulares
        var paradas_autobus=L.layerGroup([paradas_bus,layer_postes_urbanos_0]);

        var paradas_tranvia = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "paradas_tranvia",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group2 = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_paradas_tranvia(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Parada</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['title'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Tiempo de espera</strong><br />' + (feature.properties['title'] !== null ? Autolinker.link(String(feature.properties['description'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        } //Atributos y características de los popups de cada una de las paradas
        function style_paradas_tranvia() {
            return {
                pane: 'pane_paradas_tranvia',
                radius: 8.0,
                opacity: 0,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 0,
                fillColor: '#2986D4',
            }
        } //Estilo de cada uno de los popups de las paradas
        map.createPane('pane_paradas_tranvia');
        map.getPane('pane_paradas_tranvia').style.zIndex = 400;
        map.getPane('pane_paradas_tranvia').style['mix-blend-mode'] = 'normal';
        var layer_paradas_tranvia = new L.geoJson(json_paradas_tranvia, {
            attribution: '',
            pane: 'pane_paradas_tranvia',
            onEachFeature: pop_paradas_tranvia,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_paradas_tranvia(feature));
            },
        }); //Estilos de los postes, en este caso circulares
        var paradas_tranvia2=L.layerGroup([paradas_tranvia,layer_paradas_tranvia]);

      var paradas_taxi = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "paradas_taxi",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group4 = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_paradas_taxi(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Parada</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['title'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        } //Atributos y características de los popups de cada una de las paradas
        function style_paradas_taxi() {
            return {
                pane: 'pane_postes_urbanos_0',
                radius: 8.0,
                opacity: 0,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 0,
                fillColor: '#2986D4',
            }
        } //Estilo de cada uno de los popups de las paradas
        map.createPane('pane_paradas_taxi');
        map.getPane('pane_paradas_taxi').style.zIndex = 400;
        map.getPane('pane_paradas_taxi').style['mix-blend-mode'] = 'normal';
        var layer_paradas_taxi = new L.geoJson(json_paradas_taxi, {
            attribution: '',
            pane: 'pane_paradas_taxi',
            onEachFeature: pop_paradas_taxi,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_paradas_taxi(feature));
            },
        }); //Estilos de los postes, en este caso circulares
        var paradas_de_taxi=L.layerGroup([paradas_taxi,layer_paradas_taxi]);

        var aparc_discapacitados = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "aparc_discapacitados",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });  

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group4 = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_aparc_discapacitados(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Localización</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['description'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        } //Atributos y características de los popups de cada una de las paradas
        function style_aparc_discapacitados() {
            return {
                pane: 'pane_aparc_discapacitados',
                radius: 8.0,
                opacity: 0,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 0,
                fillColor: '#2986D4',
            }
        } //Estilo de cada uno de los popups de las paradas
        map.createPane('pane_aparc_discapacitados');
        map.getPane('pane_aparc_discapacitados').style.zIndex = 400;
        map.getPane('pane_aparc_discapacitados').style['mix-blend-mode'] = 'normal';
        var layer_aparc_discapacitados = new L.geoJson(json_aparc_discapacitados, {
            attribution: '',
            pane: 'pane_aparc_discapacitados',
            onEachFeature: pop_aparc_discapacitados,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_aparc_discapacitados(feature));
            },
        }); //Estilos de los postes, en este caso circulares
        var discapacitados=L.layerGroup([aparc_discapacitados,layer_aparc_discapacitados]);

        var parquimetros = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "parquimetros",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group4 = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_parquimetros(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Localización</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['title'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Localización</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['description'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        } //Atributos y características de los popups de cada una de las paradas
        function style_parquimetros() {
            return {
                pane: 'pane_parquimetros',
                radius: 8.0,
                opacity: 0,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 0,
                fillColor: '#2986D4',
            }
        } //Estilo de cada uno de los popups de las paradas
        map.createPane('pane_parquimetros');
        map.getPane('pane_parquimetros').style.zIndex = 400;
        map.getPane('pane_parquimetros').style['mix-blend-mode'] = 'normal';
        var layer_parquimetros = new L.geoJson(json_parquimetros, {
            attribution: '',
            pane: 'pane_parquimetros',
            onEachFeature: pop_parquimetros,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_parquimetros(feature));
            },
        }); //Estilos de los postes, en este caso circulares
        var parking_priv=L.layerGroup([parquimetros,layer_parquimetros]);

        var aparc_publico = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "aparc_publico",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');
        var bounds_group4 = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_aparc_publico(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Nombre</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['title'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Localización</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['description'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Horario</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['horario'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Entrada peatones</strong><br />' + (feature.properties['id'] !== null ? Autolinker.link(String(feature.properties['accesoPeaton'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        } //Atributos y características de los popups de cada una de las paradas
        function style_aparc_publico() {
            return {
                pane: 'pane_aparc_publico',
                radius: 8.0,
                opacity: 0,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 0,
                fillColor: '#2986D4',
            }
        } 
        map.createPane('pane_aparc_publico');
        map.getPane('pane_aparc_publico').style.zIndex = 400;
        map.getPane('pane_aparc_publico').style['mix-blend-mode'] = 'normal';
        var layer_aparc_publico = new L.geoJson(json_aparc_publico, {
            attribution: '',
            pane: 'pane_aparc_publico',
            onEachFeature: pop_aparc_publico,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_aparc_publico(feature));
            },
        }); //Estilos de los postes, en este caso circulares
        var aparc_public=L.layerGroup([aparc_publico,layer_aparc_publico]);

        var baseMaps = {
                "Mapa base Carto": carto,
        };
    
        var groupedOverlays = {
        "Autobuses": {
            "Líneas": linbus,
            "Paradas": paradas_autobus,
        },
        "Tranvía": {
            "Paradas": paradas_tranvia2,
        },
        "Taxis": {
            "Paradas": paradas_de_taxi,
        },
        "Aparcamientos": {
            "Públicos": aparc_public,
            "Parquímetros": parking_priv,
            "Para discapacitados": discapacitados,
        },
            };

    //Incorporación de los GeoJSON tranvía y aparcabicis en formato JS a las capas de supersposición (Overlay)
        var controlCapas = L.control.groupedLayers(baseMaps, groupedOverlays).addTo(map);
        document.getElementById("control-capas").appendChild(controlCapas.getContainer()
        ); //Introducción de la variable controlcapas al elemento del sidebar denominado control-capas
      
        var c = new L.Control.Coordinates();
        c.addTo(map);

        var osmGeocoder = new L.Control.Geocoder({
                collapsed: true,
                position: 'topleft',
                text: 'Search',
                title: 'Testing'
            }).addTo(map);
            document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
            .className += ' fa fa-search';
            document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
            .title += 'Buscador callejero';

            var lc = L.control.locate({
            strings: {
                title: "Localización actual"
            }
        }).addTo(map);
        
        var legend = L.control({position: 'bottomright'});
 
        legend.onAdd = function (map) {
        
        var div = L.DomUtil.create('div', 'info legend');
        
        div.innerHTML +=
        '<img alt="legend" src="http://104.199.101.9:8079/geoserver/VISOR2DH/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=VISOR2DH:aparc_discapacitados" width="127" height="120" />'; 
        }; 
        legend.addTo(map);
    </script> 
</html>