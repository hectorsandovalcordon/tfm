<!DOCTYPE html>
<!-- Etiqueta que define la raíz del documento -->
<html>
  <!-- Etiqueta que define el título, metadatos y diversos enlaces -->
  <head>
    <!-- Titulo que aparece en la pestaña de la página web -->
    <title>Visor Cartográfico</title>

    <!-- Metadatos de la página -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Demo project with jQuery">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Enlaces a librerías, hojas de estilo y plugins de leaflet  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
    <link rel="stylesheet" href="css/leaflet-sidebar.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-search@d4cbd36122efc8d17152b4177ed0e12165305441/dist/css/L.Control.OpenCageData.Search.min.css" />
    <link rel="stylesheet" href="css/catastro.css" />
    <link rel="stylesheet" href="css/leaflet.groupedlayercontrol.min.css" />
    <link rel="stylesheet" href="css/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="css/Control.FullScreen.css" />
    <link rel="stylesheet" href="css/Control.Coordinates.css" />
    <link rel="stylesheet" href="css/index.css" />

  </head>
  <!-- Cuerpo de la página web, donde se va a mostrar el contenido al usuario  -->
  <body>  
    <!-- Barra de navegación superior de la página web con diferentes opciones para interactuar con otros html  -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Visor Cartográfico</a>
        </div>
          <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="#">Accesibilidad en el municipio de Zaragoza</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Barra de navegación situada en la parte izquierda del visor para interactuar con las capas, leyenda, etc.  -->
    <div id="container" class="container-fluid">
        <div id="sidebar" class="sidebar collapsed">
          <div class="sidebar-tabs">
              <ul role="tablist">
                  <li><a href="#home" role="tab"><i class="fa fa-map"></i></a></li>
                  <li><a href="#leyenda" role="tab"><i class="fa fa-photo"></i></a></li>
                  <li><a href="#rutas" role="tab"><i class="fa fa-road"></i></a></li>
                  <li><a href="#contacto" role="tab"><i class="fa fa-user"></i></a></li>
                  <li><a href="#info" role="tab"><i class="fa fa-info-circle"></i></a></li>
                </ul>
  
              <ul role="tablist">
                  <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
              </ul>
          </div>
          <div class="sidebar-content">
          <div class="sidebar-pane" id="home">
              <h1 class="sidebar-header">Capas<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <div class="" id="control-capas">
              </div>
          </div>
          <div class="sidebar-pane" id="leyenda">
              <h1 class="sidebar-header">Leyenda<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <div class="" id="control-leyenda">
              <br>
              </div>
          </div>
          <div class="sidebar-pane" id="rutas">
              <h1 class="sidebar-header">Calculadora de rutas<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <div class="" id="control-rutas">
                <br><h4>¿Cómo funciona?</h4>
                <p>En el visor se pueden observar dos popups o marcadores de color azul los cuales se corresponden con las localizaciondes de inicio y final de la ruta. Una vez colocadas donde queramos, abriremos la ventana emergente de Calculadora de rutas (donde nos encontramos ahora mismo) y, en la parte inferior podremos ver el itinerario completo de la ruta más óptima, además de los kilómetros y tiempo aproximado de realización.</p>
                <br><h4>Itinerario</h4>
              </div>
          </div>
          <div class="sidebar-pane" id="info">
            <h1 class="sidebar-header">Información y uso del visor<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            <br>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                  <li><a class="dropdown-item" href="#">Introducción</a></li>
                  <li><a class="dropdown-item" href="#">Cómo funciona</a></li>
                  <li><a class="dropdown-item" href="#">Datos</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            <br>
            <p>El siguiente visor cartográfico ha sido realizado por Héctor Sandoval como <b>proyecto final de máster de Tecnologías de la información: Teledetección y Sistemas de Información geográfica de la Universidad de Zaragoza</b>. <p></p>Tiene como objetivo, facilitar la accesibilidad de la población en la ciudad de Zaragoza con la interacción de una serie de capas y herramientas de transporte o enrutamiento. </p> <p>Para llevar a cabo el visor, en primer lugar se adquirió la información del <b>Catálogo de datos abiertos del ayuntamiento de Zaragoza</b>, posteriormente se incorporaron dichos datos en una base de datos mediante PostgreSQL. Una vez llevado a cabo dicho proceso, se convirtieron los datos en información mediante su visualización en geoserver, servidor a partir del cual se dió estilo a los diferentes servicios WMS y, finalmente se llevó a cabo la programación del visor así como la incorporación de los servicios WMS y WFS en el mismo.</p> 
          </div>
          <div class="sidebar-pane" id="contacto">
              <h1 class="sidebar-header">Contacto<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <br>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav" text-align=center>
                  <h4>Correo electrónico</h4><li><a class="dropdown-item" href="mailto:hectorsandovalcordon@gmail.com" target="_blank"><i class="fa fa-envelope"></i></a></li>
                  <br><br><br><h4>LinkedIn</h4><li><a class="dropdown-item" href="https://www.linkedin.com/in/hectorsandovalcordon/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
                  <br><br><br><h4>Web personal</h4><li><a class="dropdown-item" href="https://hectorsandovalcordon.github.io/tfm/" target="_blank"><i class="fa fa-copy"></i></a></li>
                    </ul>
                  </li>
                </ul>
              </div>
          </div>
          <div class="sidebar-pane" id="settings">
              <h1 class="sidebar-header">Ajustes<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
              <br><h4>Transparencia</h4>
                <input id="slide" type="range" min="0" max="1" step="0.1" value="0" onchange="updateOpacity(this.value)">  
            </div>
          </div>
        </div>
        <!-- Incorporación del mapa a la página web  -->
        <div id="mapid"></div>
  </body>
    <!-- Diferentes scripts javascript de la página web bootstrap, leaflet, etc.  -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <script src="js/leaflet-sidebar.min.js"></script>
    <script src="js/bundle.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js" ></script>
    <script src="js/leaflet.groupedlayercontrol.min.js"></script>
    <script src="js/leaflet-routing-machine.js"></script>
    <script src="js/Control.FullScreen.js"></script>
    <script src="js/Control.Coordinates.js"></script>
    <script src="js/Control.Geocoder.js"></script>
    <script src="js/config.js"></script>
    <script src="js/index.js"></script>
    <script type="text/javascript">
//Creación de la variable mapa  
    var map = L.map ('mapid',{
      center:[41.65, -0.85],
      zoom: 13,
      fullscreenControl: true,
			fullscreenControlOptions: { // optional
				title:"Mostrar pantalla completa",
				titleCancel:"Salir del modo pantalla completa"
			}
		});

    map.on('enterFullscreen', function(){
			if(window.console) window.console.log('enterFullscreen');
		});
		map.on('exitFullscreen', function(){
			if(window.console) window.console.log('exitFullscreen');
    });

    map.on('click', function(e) {
      c.setCoordinates(e);
    });

    
//Creación del sidebar control
    var sidebar = L.control.sidebar('sidebar').addTo(map); //Creación de la variable sidebar (barra de interacción de la parte izquierda)
//Creación de las imágenes de referencia de OSM

var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    var byn = L.tileLayer('http://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    });

    var controlRutas = L.Routing.control({
    waypoints: [
        L.latLng(41.6476, -0.9133),
        L.latLng(41.6477, -0.8969)
    ],
    routeWhileDragging: true,
    }).addTo(map);
    document.getElementById("control-rutas").appendChild(controlRutas.getContainer()
    );

    //Creación de variables de las dos capas base de servicio wms procedentes de OSM
//Incorporación de los servicios WMS y WFS
      var aparc_discapacitados = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "aparc_discapacitados",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });  
      var paradas_taxi = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "paradas_taxi",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });
      var parquimetros = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "parquimetros",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });
      var aparc_publico = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "aparc_publico",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });
        var linbus = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "lineas_autobus",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });
      
        function updateOpacity(value) {
              linbus.setOpacity(value);
        } 
        var paradas_bus = L.tileLayer.wms("http://localhost:8080/geoserver/tfm/wms", {
        layers: "paradas_bus",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });
        var paradas_tranvia = L.tileLayer.wms("http://104.199.101.9:8079/geoserver/VISOR2DH/wms", {
        layers: "paradas_tranvia",//nombre de la capa (ver get capabilities)
        format: 'image/png',
        transparent: true,
        version: '1.1.0',//wms version (ver get capabilities)
        attribution: "Geoserver WMS."
        });

//LLamada de las variables creadas al control de capas
    var baseLayers = {
      "Open Street Maps (Color)": osm,
      "Open Street Maps (B&N)": byn,
        };    
    
    var groupedOverlays = {
      "Autobuses": {
        "Líneas": linbus,
        "Paradas": paradas_bus,
      },
      "Tranvía": {
        "Paradas": paradas_tranvia,
      },
      "Taxis": {
        "Paradas": paradas_taxi,
      },
      "Aparcamientos": {
        "Públicos": aparc_publico,
        "Parquímetros": parquimetros,
        "Para discapacitados": aparc_discapacitados,
      },
        };

    //Incorporación de los GeoJSON tranvía y aparcabicis en formato JS a las capas de supersposición (Overlay)
      var controlCapas = L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);
      document.getElementById("control-capas").appendChild(controlCapas.getContainer()
    );

    //Condenadas del mapa    
    var c = new L.Control.Coordinates();
    c.addTo(map);

    </script> 
</html>